name: Fetch Streak SVG

# run on push to main and daily (so README is kept fresh)
on:
  push:
    branches: ["main"]
  schedule:
    - cron: '0 0 * * *'   # daily at 00:00 UTC (adjust if you want)

permissions:
  contents: write   # allow pushing the file back into the repo

jobs:
  fetch-streak:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Ensure assets folder
        run: |
          mkdir -p assets

      - name: Download streak SVG (demolab fallback)
        id: download
        run: |
          STREAK_URL="https://streak-stats.demolab.com/?user=Sabbir-Aahmed&theme=swift&hide_border=true"
          echo "Trying $STREAK_URL"
          # try curling the URL - if it fails, exit non-zero
          curl -fsSL "$STREAK_URL" -o assets/streak.svg
          echo "Downloaded streak.svg size: $(stat -c%s assets/streak.svg)"

      - name: Commit & push SVG if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add assets/streak.svg
          # If there are no changes, commit will fail; handle that gracefully.
          git commit -m "chore: update streak SVG" || echo "No changes to commit"
          git push || echo "Push failed; check permissions"
